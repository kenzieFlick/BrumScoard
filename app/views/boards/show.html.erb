<%= javascript_include_tag "sortable" %>
<%= yield :js %>

<div class="boardActions">
  <div class="boardTitle"><h1><%= @board.name %></h1></div>
  <div class="singularAction"><%= link_to 'Return to boards', boards_path %></div>
  <% if current_user_role == Membership.roles[:developer] %>
      <div class="singularAction"><%= link_to 'Add story to product backlog', newstory_path %></div>
  <% end %>
  <div class="singularAction"><%= link_to 'Manage members', invite_path %></div>
</div>
<br />


<div class="column" data-col="0">
    <h2>Product Backlog</h2>
    <div class="cards">
        <% (current_board.stories.select {|story| story.column == 0}).each do |story|%>
            <div class="card" id="<%= story.id %>">
                <%= link_to editstory_path(current_board.id, story.id) do %><div class="text-fa"><span class="fa fa-edit"></span>&nbsp;Edit</div><% end %>
                <%= link_to newtask_path(current_board.id, story.id) do %><div class="text-fa"><span class="fa fa-plus-circle"></span>&nbsp;Add task&nbsp;&nbsp;</div><% end %>
                <% if !story.description.blank? %>
                    <div class="info">
                        <strong><%= story.description %></strong>
                    </div>
                <% end %>

                <% if !story.want.blank? %>
                    <div class="info">
                        <%= "As " + story.as + ", I want " + story.want + " so that " + story.so_that %>
                    </div>
                <% end %>

                <% if !story.criteria.blank? %>
                    <div class="info">
                        <%= 'Acceptance criteria: ' + story.criteria %>
                    </div>
                <% end %>

                <% if !story.size.blank? %>
                    <div class="info">
                        <%= 'Size estimate: ' + story.size %>
                    </div>
                <% end %>

            </div>
        <% end%>
    </div>
</div>

<div class="column" data-col="1">
    <h2>Sprint Backlog</h2>
    <div class="cards">
        <% (current_board.stories.select {|story| story.column == 1}).each do |story|%>
            <div class="card" id="<%= story.id %>">
                <%= link_to editstory_path(current_board.id, story.id) do %><div class="text-fa"><span class="fa fa-edit"></span>&nbsp;Edit</div><% end %>
                <%= link_to newtask_path(current_board.id, story.id) do %><div class="text-fa"><span class="fa fa-plus-circle"></span>&nbsp;Add task&nbsp;&nbsp;</div><% end %>
                <% if !story.description.blank? %>
                    <div class="info">
                        <strong><%= story.description %></strong>
                    </div>
                <% end %>

                <% if !story.want.blank? %>
                    <div class="info">
                        <%= "As " + story.as + ", I want " + story.want + " so that " + story.so_that %>
                    </div>
                <% end %>

                <% if !story.criteria.blank? %>
                    <div class="info">
                        <%= 'Acceptance criteria: ' + story.criteria %>
                    </div>
                <% end %>

                <% if !story.size.blank? %>
                    <div class="info">
                        <%= 'Size estimate: ' + story.size %>
                    </div>
                <% end %>

            </div>
        <% end%>
    </div>
</div>

<div class="column" data-col="2">
    <h2>To Do</h2>
    <div class="cards">
      <% current_board.stories.each do |story|%>
        <% (story.tasks.select {|task| task.column == 2}).each do |task| %>
          <div class="task" id="<%= task.id %>">
              <%= link_to edittask_path(current_board.id, story.id, task.id) do %><div class="text-fa"><span class="fa fa-edit"></span>&nbsp;Edit</div><% end %>
                  <div class="info">
                    <span style="text-decoration:underline;"><%= story.description %></span>
                  </div>
              <% if !task.description.blank? %>
                  <div class="info">
                      <%= task.description %>
                  </div>
              <% end %>

              <% if !task.weight.blank? %>
                  <div class="info">
                      <%= "Weight: " + task.weight.to_s %>
                  </div>
              <% end %>

              <% if !task.user.blank? %>
                  <div class="info">
                      <%= 'Assigned user: ' + task.user.username %>
                  </div>
              <% end %>
          </div>
      <% end %>
    <% end %>
  </div>
</div>


<div class="column" data-col="3">
    <h2>Doing</h2>
    <div class="cards">
      <% current_board.stories.each do |story|%>
        <% (story.tasks.select {|task| task.column == 3}).each do |task| %>
          <div class="task" id="<%= task.id %>">
              <%= link_to edittask_path(current_board.id, story.id, task.id) do %><div class="text-fa"><span class="fa fa-edit"></span>&nbsp;Edit</div><% end %>
                  <div class="info">
                    <span style="text-decoration:underline;"><%= story.description %></span>
                  </div>
              <% if !task.description.blank? %>
                  <div class="info">
                      <%= task.description %>
                  </div>
              <% end %>

              <% if !task.weight.blank? %>
                  <div class="info">
                      <%= "Weight: " + task.weight.to_s %>
                  </div>
              <% end %>

              <% if !task.user.blank? %>
                  <div class="info">
                      <%= 'Assigned user: ' + task.user.username %>
                  </div>
              <% end %>
          </div>
      <% end %>
    <% end %>
  </div>
</div>


<div class="column" data-col="4">
    <h2>Done</h2>
    <div class="cards">
      <% current_board.stories.each do |story|%>
        <% (story.tasks.select {|task| task.column == 4}).each do |task| %>
          <div class="task" id="<%= task.id %>">
              <%= link_to edittask_path(current_board.id, story.id, task.id) do %><div class="text-fa"><span class="fa fa-edit"></span>&nbsp;Edit</div><% end %>
                  <div class="info">
                    <span style="text-decoration:underline;"><%= story.description %></span>
                  </div>
              <% if !task.description.blank? %>
                  <div class="info">
                      <%= task.description %>
                  </div>
              <% end %>

              <% if !task.weight.blank? %>
                  <div class="info">
                      <%= "Weight: " + task.weight.to_s %>
                  </div>
              <% end %>

              <% if !task.user.blank? %>
                  <div class="info">
                      <%= 'Assigned user: ' + task.user.username %>
                  </div>
              <% end %>
          </div>
      <% end %>
    <% end %>
  </div>
</div>

<br />
